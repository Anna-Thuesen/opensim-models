<!DOCTYPE html>
<html>
    <head>
        <title>OpenSim Documentation : Tutorial 3 - Scaling, Inverse Kinematics, and Inverse Dynamics</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">OpenSim Documentation</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            OpenSim Documentation : Tutorial 3 - Scaling, Inverse Kinematics, and Inverse Dynamics
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
        
    
        
        
            Created by <span class='author'> James Dunne</span>, last modified by <span class='editor'> Thomas Uchida</span> on Apr 05, 2018
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <p><style type='text/css'>/*<![CDATA[*/
div.rbtoc1530815061437 {padding: 0px;}
div.rbtoc1530815061437 ul {list-style: disc;margin-left: 0px;}
div.rbtoc1530815061437 li {margin-left: 0px;padding-left: 0px;}

/*]]>*/</style><div class='toc-macro rbtoc1530815061437'>
<ul class='toc-indentation'>
<li><a href='#Tutorial3-Scaling,InverseKinematics,andInverseDynamics-I.Objectives'>I. Objectives</a>
<ul class='toc-indentation'>
<li><a href='#Tutorial3-Scaling,InverseKinematics,andInverseDynamics-Purpose'>Purpose</a></li>
<li><a href='#Tutorial3-Scaling,InverseKinematics,andInverseDynamics-Format'>Format</a></li>
</ul>
</li>
<li><a href='#Tutorial3-Scaling,InverseKinematics,andInverseDynamics-II.GenericMusculoskeletalModel'>II. Generic Musculoskeletal Model</a></li>
<li><a href='#Tutorial3-Scaling,InverseKinematics,andInverseDynamics-III.ScalingAMusculoskeletalModel'>III. Scaling A Musculoskeletal Model</a></li>
<li><a href='#Tutorial3-Scaling,InverseKinematics,andInverseDynamics-IV.InverseKinematics'>IV. Inverse Kinematics</a></li>
<li><a href='#Tutorial3-Scaling,InverseKinematics,andInverseDynamics-V.InverseDynamics'>V. Inverse Dynamics</a></li>
</ul>
</div></p><h2 id="Tutorial3-Scaling,InverseKinematics,andInverseDynamics-I.Objectives"><span style="color: rgb(41,41,41);">I. <span style="color: rgb(0,0,0);">Objectives</span></span></h2><h3 id="Tutorial3-Scaling,InverseKinematics,andInverseDynamics-Purpose"><span style="color: rgb(0,0,0);">Purpose</span></h3><p>The purpose of this tutorial is to demonstrate how <span class="inline-comment-marker" data-ref="a18c6e22-faf3-42b9-b727-d4d821c6f9a6">OpenSim solves an inverse kinematics problem and an inverse dynamics problem using experimental data. To diagnose movement disorders and study human movement, biomechanists frequently ask human subjects to perform movements in a motion capture laboratory and use computational tools to analyze these movements. A common step in analyzing a movement is to compute the joint angles and joint moments of the subject during movement. OpenSim has tools for computing these quantities:</span></p><ol><li><em><span class="inline-comment-marker" data-ref="a18c6e22-faf3-42b9-b727-d4d821c6f9a6">Inverse kinematics</span></em><span class="inline-comment-marker" data-ref="a18c6e22-faf3-42b9-b727-d4d821c6f9a6"> is used to compute joint angles.</span></li><li><em><span class="inline-comment-marker" data-ref="a18c6e22-faf3-42b9-b727-d4d821c6f9a6">Inverse dynamics</span></em><span class="inline-comment-marker" data-ref="a18c6e22-faf3-42b9-b727-d4d821c6f9a6"> is used to compute net joint reaction forces and net joint moments.</span></li></ol><p><em>Inverse kinematics</em> computes the joint angles for a musculoskeletal model that best reproduce the motion of a subject. <em>Inverse dynamics</em> then uses joint angles, angular velocities, and angular accelerations of the model, together with the experimental ground reaction forces and moments, to solve for the net reaction forces and net moments at each of the joints. The schematic below shows an overview of the inverse kinematics and inverse dynamics problems. <br class="atl-forced-newline" /> <span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="attachments/5115855/5046826.png" data-image-src="attachments/5115855/5046826.png" data-unresolved-comment-count="0" data-linked-resource-id="5046826" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="worddav18beee95e9328969b6f5ee05a6c736f0.png" data-base-url="https://simtk-confluence.stanford.edu" data-linked-resource-content-type="image/png" data-linked-resource-container-id="5115855" data-linked-resource-container-version="33"></span> <br class="atl-forced-newline" />In this tutorial, you will:</p><ul><li>Become familiar with OpenSim's Scale, Inverse Kinematics and Inverse Dynamics tools</li><li>Solve an inverse kinematics and inverse dynamics problem using experimental data</li><li>Interpret the results of the inverse dynamics solution</li><li>Investigate the dynamic inconsistencies that arise during inverse dynamics</li></ul><h3 id="Tutorial3-Scaling,InverseKinematics,andInverseDynamics-Format"><span style="color: rgb(0,0,0);"> Format</span></h3><p>Each section of the tutorial guides you in using certain tools within and asks you to answer a few questions. The menu titles and option names you must select and any commands you must type to run OpenSim will appear in <strong>bold face</strong>. The questions can be answered based on information from OpenSim and basic knowledge of the human musculoskeletal system. After you complete the tutorial, feel free to explore OpenSim and the other analysis tools further on your own. Depending on the amount of exploration you do, this tutorial should take 1-2 hours to complete.</p><h2 id="Tutorial3-Scaling,InverseKinematics,andInverseDynamics-II.GenericMusculoskeletalModel"><span style="color: rgb(0,0,0);">II. Generic Musculoskeletal Model</span></h2><p>In this tutorial, you will be using a generic musculoskeletal model with 23 degrees of freedom and actuated by 54 muscles entitled <em>3DGaitModel2354</em>. It is a simplified version of the lower-extremity model of Delp et al. [1], modified to include a torso and back joint based on the model of Anderson and Pandy [2].</p><p>To load the generic musculoskeletal model into OpenSim:</p><ul><li>Click the <strong>File</strong> menu and select <strong>Open Model</strong>.</li></ul><ul><li>Find the <strong><em>Models</em></strong> folder, which is located under your OpenSim installation directory, e.g., <em>C:\OpenSim3.2. (The actual directory name depends on version used and can be changed</em> <em>during installation).</em></li></ul><ul><li>Open the <strong><em>Gait2354_Simbody</em></strong> folder, select the file <strong><em>gait2354_simbody.osim</em></strong>, and click <strong>Open</strong>.</li></ul><p>The experimental gait data were collected by Jill Higginson and Chand John in the Neuromuscular Biomechanics Lab at the University of Delaware as part of the study cited below. The data include marker trajectories and ground reaction forces for an adult male walking at a self-selected speed on an instrumented split-belt treadmill. Please note that the data distributed with OpenSim is from a different subject than the one described in the paper. Data collection protocols were the same for both subjects.</p><p>Chand T. John, Frank C. Anderson, Jill S. Higginson &amp; Scott L. Delp (2012): Stabilisation of walking by intrinsic muscle properties revealed in a three-dimensional muscle-driven simulation, Computer Methods in Biomechanics and Biomedical Engineering.</p><h2 id="Tutorial3-Scaling,InverseKinematics,andInverseDynamics-III.ScalingAMusculoskeletalModel"><span style="color: rgb(0,0,0);">III. Scaling A Musculoskeletal Model</span></h2><p>The purpose of scaling a generic musculoskeletal model is to modify the anthropometry, or physical dimensions, of the generic model so that it matches the anthropometry of a particular subject. Scaling is one of the most important steps in solving inverse kinematics and inverse dynamics problems because these solutions are sensitive to the accuracy of the scaling step. In OpenSim, the scaling step adjusts both the mass properties (mass and inertia tensor), as well as the dimensions of the body segments. Scaling can be performed using a combination of two methods:</p><p style="margin-left: 30.0px;"><em>(1) Measurement-based Scaling</em>: This type of scaling determines scale factors for a body segment by comparing distance measurements between specified landmarks on the model, known as <em>virtual markers</em>, and the corresponding <em>experimental marker</em> positions.</p><p style="margin-left: 30.0px;"><em style="font-size: 10.0pt;line-height: 13.0pt;">(2) Manual Scaling</em><span style="font-size: 10.0pt;line-height: 13.0pt;">: This type of scaling allows the user to scale a segment based on some predetermined scale factor. Manual scaling is sometimes necessary when suitable marker data are not available, or if the scale factors were determined using an alternative algorithm.</span></p><p><span style="font-size: 10.0pt;line-height: 13.0pt;">To scale the generic model: </span></p><ul><li>Click the <strong>Tools</strong> menu and select <strong>Scale Model</strong>.</li></ul><ul><li>At the bottom of the <em>Scale Tool</em> dialog, click <strong>Load</strong> to input a settings file.</li></ul><ul><li>In the file browser, ensure that you are in the <strong><em>Gait2354_Simbody</em></strong> folder, select the file <strong><em>subject01_Setup_Scale.xml</em></strong> and click <strong>Open</strong>.</li></ul><p>This <em>xml</em> file contains pre-configured settings to scale the generic musculoskeletal model to the dimensions of the subject. Notice all of the textboxes in the dialog were filled in appropriately.</p><h4 id="Tutorial3-Scaling,InverseKinematics,andInverseDynamics-Questions"><span style="color: rgb(0,0,0);">Questions</span></h4><p><em>1. Based on information in the Scale Tool dialog, what is the mass of the generic musculoskeletal model? What was the mass of the subject?</em></p><p><span style="font-size: 10.0pt;line-height: 13.0pt;">2. To see the loaded scale factors, click on the </span><strong style="font-size: 10.0pt;line-height: 13.0pt;">Scale Factors</strong><span style="font-size: 10.0pt;line-height: 13.0pt;"> tab. </span><em style="font-size: 10.0pt;line-height: 13.0pt;">Which body segments were scaled manually?</em></p><p>3.<em> </em><em>Based on information in the Inverse Kinematics Tool</em> <em>dialog, at what frequency was the experimental motion data captured? Hint</em><em>: Look for the box titled Marker Data.</em></p><p>To complete the scale step:</p><ul><li>In the <em>Scale Tool</em> dialog, click <strong>Run</strong>. Then click <strong>Close</strong>.</li></ul><ul><li>To save the scaled model, click <strong>File</strong> and select <strong>Save Model.</strong></li></ul><ul><li>Ensure that you are in the <strong><em>Gait2354_Simbody</em></strong> folder, type <strong><em>gait2354_scaled.osim</em></strong> into the <strong>File name</strong> textbox, and click <strong>Save</strong>.</li></ul><p><span style="font-size: 10.0pt;line-height: 13.0pt;">When complete, a new, scaled model entitled </span><em style="font-size: 10.0pt;line-height: 13.0pt;">subject01</em><span style="font-size: 10.0pt;line-height: 13.0pt;"> will appear in </span><em style="font-size: 10.0pt;line-height: 13.0pt;">View</em><span style="font-size: 10.0pt;line-height: 13.0pt;"> window. Notice the pink<span class="inline-comment-marker" data-ref="77bf98f1-e94c-4a3a-93f1-666ab503db25"> markers</span> around the new model. The <span class="inline-comment-marker" data-ref="9ccccde9-1e45-47ff-bb01-6417fa83c4f0">blue</span> spheres graphically represent the </span><em style="font-size: 10.0pt;line-height: 13.0pt;">experimental markers</em><span style="font-size: 10.0pt;line-height: 13.0pt;"> from the motion capture data used in the measurement-based scaling. </span></p><p><span style="font-size: 10.0pt;line-height: 13.0pt;">At this point, you may close the generic model (right-click the model name in the Navigator window, and select &quot;close&quot;) or hide the model (right-click the model name, and select Display &gt;&gt; Hide).<br /></span></p><h2 id="Tutorial3-Scaling,InverseKinematics,andInverseDynamics-IV.InverseKinematics"><span style="color: rgb(0,0,0);">IV. Inverse Kinematics</span></h2><p><span style="color: rgb(0,0,0);"><em>Kinematics</em> is the study of motion without considering the forces and moments that produce that motion. Thus, to perform kinematical analyses, such as inverse kinematics, mass and inertia properties are not needed. The purpose of inverse kinematics is to find the joint angles of the model that best reproduce the experimental kinematics of a particular subject. In this tutorial, the experimental kinematics used by the inverse kinematics tool are based on <em>experimental marker</em> positions<em>.</em></span></p><p>The inverse kinematics tool goes through each time step, or frame, of recorded motion and computes the set of joint angles that put the model in a configuration that &quot;best match&quot; the experimental kinematics. OpenSim determines this &quot;best match&quot; by solving a weighted least squares optimization problem with the goal of minimizing <em>marker error</em>. For more information about optimization and least-squares problems, see Chapter 1 of <em>Convex Optimization</em> by Stephen Boyd and Lieven Vandenberghe (<a class="external-link" href="http://www.stanford.edu/~boyd/cvxbook/" rel="nofollow">http://www.stanford.edu/~boyd/cvxbook/</a>).</p><p><em>Marker error</em> is defined as the distance between an <em>experimental marker</em> and the corresponding <em>virtual marker</em>. Each marker has an associated weighting value, specifying how strongly that marker's error term should be minimized in the least squares problem. In each frame, the inverse kinematics tool solves for a vector of generalized coordinates (e.g., joint angles), <strong>q</strong>, that minimizes the weighted sum of marker errors, which is expressed as</p>
<script>
function writeConsole1471267180() {
 top.consoleRef=window.open('','myconsole',
  'width=600,height=600'
   +',menubar=0'
   +',toolbar=1'
   +',status=0'
   +',scrollbars=1'
   +',resizable=1');
 top.consoleRef.document.writeln(
  '<html><head><title>LaTeX Math error</title></head>'
   +'<body bgcolor=white onLoad="self.focus()">'
   +'An error occurred while rendering macro type: mathblock.<br/><br/>'
   +'==================== LaTeX to render: ====================='
   +'<br/>'+$('#latexmarkup')[0].innerHTML.replace(/\r?\n/g,"\n<br />")+'<br/><br/>'
   +'======================= Error: ============================'
   +'<br/>'+$('#latexerrormsg')[0].innerHTML.replace(/\r?\n/g,"\n<br />")+'<br/><br/>'
   +'</body></html>'
 );
 top.consoleRef.document.close()
}
</script>

<div class="aui-message error">
    Error rendering 'mathblock' macro:
    (<a href="#" OnClick="javascript:writeConsole1471267180();return false;">show error message</a>).
        <span id="latexmarkup" style="display: none">$\min_q \left[ \sum_{i \in \mathrm{markers}} w_i \left\| \mathbf{x}_i^{\mathrm{exp}} - \mathbf{x}_i(\mathbf{q}) \right\|^2 \right]$</span>
        <span id="latexerrormsg" style="display: none">The MathJax service is not running, please check your Confluence logs or choose another renderer in the LaTeX Math settings.</span>
    </div>
<p><span style="font-size: 10.0pt;line-height: 13.0pt;">where </span><strong style="font-size: 10.0pt;line-height: 13.0pt;">q</strong><span style="font-size: 10.0pt;line-height: 13.0pt;"> is the vector of generalized coordinates (e.g., joint angles), </span><strong style="font-size: 10.0pt;line-height: 13.0pt;">x</strong><em style="font-size: 10.0pt;line-height: 13.0pt;"><sub>i</sub></em><strong style="font-size: 10.0pt;line-height: 13.0pt;"><sup>exp</sup></strong><span style="font-size: 10.0pt;line-height: 13.0pt;"> is the position of </span><em style="font-size: 10.0pt;line-height: 13.0pt;">experimental marker</em><span style="font-size: 10.0pt;line-height: 13.0pt;"> </span><em style="font-size: 10.0pt;line-height: 13.0pt;">i</em><span style="font-size: 10.0pt;line-height: 13.0pt;">, </span><strong style="font-size: 10.0pt;line-height: 13.0pt;">x</strong><em style="font-size: 10.0pt;line-height: 13.0pt;"><sub>i</sub></em><span style="font-size: 10.0pt;line-height: 13.0pt;">(</span><strong style="font-size: 10.0pt;line-height: 13.0pt;">q</strong><span style="font-size: 10.0pt;line-height: 13.0pt;">) is the position of the corresponding </span><em style="font-size: 10.0pt;line-height: 13.0pt;">virtual marker i</em><span style="font-size: 10.0pt;line-height: 13.0pt;"> (which depends on </span><strong style="font-size: 10.0pt;line-height: 13.0pt;">q</strong><span style="font-size: 10.0pt;line-height: 13.0pt;">), and </span><em style="font-size: 10.0pt;line-height: 13.0pt;">w<sub>i</sub></em><span style="font-size: 10.0pt;line-height: 13.0pt;"> is the weight associated with marker </span><em style="font-size: 10.0pt;line-height: 13.0pt;">i</em><span style="font-size: 10.0pt;line-height: 13.0pt;">.</span></p><p>To solve the inverse kinematics problem:</p><ul><li>Click the <strong>Tools</strong> menu and select <strong>Inverse Kinematics</strong>.</li></ul><ul><li>In the <em>Inverse Kinematics Tool</em> dialog, click <strong>Load</strong> to load an Inverse Kinematics setup file.</li></ul><ul><li>In the file browser, ensure that you are in the <strong><em>Gait2354_Simbody</em></strong> folder, select the file <strong><em>subject01_Setup_IK.xml</em></strong> and click <strong>Open</strong>.</li></ul><p>This <em>xml</em> file contains pre-configured settings to solve the inverse kinematics problem for the scaled model. Notice all of the textboxes in the dialog were filled in appropriately.</p><h4 id="Tutorial3-Scaling,InverseKinematics,andInverseDynamics-Questions.1"><span style="color: rgb(0,0,0);">Questions</span></h4><p><span style="color: rgb(0,0,0);">4. Click the <strong>Weights</strong> tab and scroll through the list of markers in the top half of the dialog. <em>Which markers have weighting values less than one? Why?</em></span><br /><span style="color: rgb(0,0,0);"> <em>Hint</em><em>: Think about joints that have not been modeled</em>.</span></p><p>To complete inverse kinematics step:</p><ul><li>In the <em>Inverse Kinematics Tool</em>, click <strong>Run</strong>. Then click <strong>Close</strong>.<br /><em>Note</em><em style="font-size: 10.0pt;line-height: 13.0pt;">: Even though you closed the dialog, the Inverse Kinematics tool is still running. Notice the progress bar in the lower right-hand corner of the program. <strong>Wait until the bar disappears before proceeding.</strong></em><span style="font-size: 10.0pt;line-height: 13.0pt;"> </span></li></ul><p>The model will begin to move slowly, as the inverse kinematics problem is being solved for each frame of the experimental data.</p><p>To compare experimental marker data with inverse kinematics results, in the <em>Navigator</em> panel, go to <strong>Motions</strong> and right-click on <strong>Results</strong> (which are what the Inverse Kinematics Tool just generated). Then choose <strong>Associate Motion Data<em>...</em></strong> from the drop down menu. Choose <em>subject_01_walk1.trc </em>and click <strong>Open</strong>. Model markers are <em>virtual markers</em> shown in pink and <em>experimental markers</em> are shown in blue. Hit play in the Motion Toolbar. The <em>virtual</em> <em>markers</em> should correspond closely to the <em>experimental marker</em> locations as the animation proceeds.<br /> <sup>*</sup>Note: If using a Virtual Machine on a Mac, Command + Ctrl + Left Click on each motion.</p><p><br class="atl-forced-newline" />When completed, examine the accuracy of the inverse kinematics solution:</p><ul><li>Click the <strong>Window</strong> menu and select <strong>Messages</strong>.</li></ul><ul><li>The <em>Messages</em> window records details of the all steps you have performed. Take a minute to explore the Messages window. Then, <strong>scroll</strong> to the very bottom.</li></ul><ul><li>The next to last line provides the markers errors and model coordinate errors (e.g., joint angle errors) associated with the last frame of the motion.<br /><em>Note</em><em style="font-size: 10.0pt;line-height: 13.0pt;">: All marker errors have units in meters, and all coordinate errors have units in radians</em><span style="font-size: 10.0pt;line-height: 13.0pt;">. <br /></span></li></ul><h4 id="Tutorial3-Scaling,InverseKinematics,andInverseDynamics-Questions.2">Questions</h4><p>5. <em>Based on information in the Messages window, what is the root-mean-squared (RMS) error of all the markers in the last frame of the motion? Include units. Does this seem reasonable? Explain.</em></p><p>6. <em>What was the value of the maximum marker error in the last frame? Include units. Which marker had this maximum error, and why?</em><br /> <em>Hint</em><em>: Think about the weighted least squares problem.</em></p><p>To visualize the inverse kinematics solution, animate the model by using the <em>motion slider</em> and <em>video controls</em>. The model should walk through one full gait cycle. <strong><em><br /></em></strong><em>Remember</em>: <em>You can <strong>loop</strong> <span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" height="13" width="20" src="attachments/5115855/5046828.png" data-image-src="attachments/5115855/5046828.png" data-unresolved-comment-count="0" data-linked-resource-id="5046828" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="worddav613169f3722e482985e2b7ba46883866.png" data-base-url="https://simtk-confluence.stanford.edu" data-linked-resource-content-type="image/png" data-linked-resource-container-id="5115855" data-linked-resource-container-version="33"></span>and control the speed of the animation.</em></p><p>The inverse kinematics solution is saved to <em>subject01_walk1_ik.mot</em> as specified in the setup file. <br /><em>Note</em><em>: Be sure to use the exact file name given, as this file is used to complete the next step.</em></p><h2 id="Tutorial3-Scaling,InverseKinematics,andInverseDynamics-V.InverseDynamics"><span style="color: rgb(0,0,0);">V. Inverse Dynamics</span></h2><p><span style="color: rgb(0,0,0);"><em>Dynamics</em> is the study of motion <em>and</em> the forces and moments that produce that motion. Thus, to perform dynamical analyses, such as inverse dynamics, estimation of mass and inertia is required. The purpose of inverse dynamics is to estimate the forces and moments that cause a particular motion, and its results can be used to infer how muscles are utilized for that motion. To determine these forces and moments, equations of motion for the system are solved iteratively [3]. The equations of motion are derived using the kinematic description and mass properties of a musculoskeletal model. Then, using the joint angles from inverse kinematics and experimental ground reaction force data, the net reaction forces and net moments at each of the joints are calculated such that the dynamic equilibrium conditions and boundary conditions are satisfied [3]. </span><span style="color: rgb(0,0,0);"> </span></p><p><span style="color: rgb(0,0,0);"><em>Note</em><em>: Joint reaction, or inter-segmental, force is the total force acting across a particular joint in a model. This should not be confused with joint bone-on-bone force, which is the actual force seen across the articulating surfaces of the joint and include the effect of muscle activity. For a thorough discussion on this topic see pp 77-79 in [4].</em></span></p><p><span style="color: rgb(0,0,0);">To solve the inverse dynamics problem:</span></p><ul><li>Click the <strong>Tools</strong> menu and select <strong>Inverse Dynamics</strong>.</li></ul><ul><li>In the <em>Inverse Dynamics Tool</em> dialog, click <strong>Load</strong> to load an Inverse Dynamics setup file.</li></ul><ul><li>In the file browser, ensure that you are in the <strong><em>Gait2354_Simbody</em></strong> folder, select the file <strong><em>subject01_Setup_InverseDynamics.xml</em></strong> and click <strong>Open</strong>.<br /><em>Note</em><em style="font-size: 10.0pt;line-height: 13.0pt;">: If the <strong>Motion From File</strong> textbox appears red, this means the textbox was filled with an inappropriate file name. Make sure the motion file was saved with the correct file name in the Inverse Kinematics section.</em><span style="font-size: 10.0pt;line-height: 13.0pt;"> </span></li></ul><ul><li>Note the folder listed in the <strong>Directory</strong> textbox, located in the <strong>Output</strong> section of the dialog. The storage file containing the inverse dynamics results will be saved in this folder: <em>examples\Gait2354_Simbody\ResultsInverseDynamics</em></li></ul><ul><li>Click <strong>Run</strong> at the bottom of the dialog. Then click <strong>Close</strong>.</li></ul><p>When completed, examine the results of the inverse dynamics solution by plotting the net moments at the left and right ankles:</p><ul><li>Click <strong>Tools</strong> and select <strong>Plot</strong>.</li></ul><ul><li>In the <em>Plotter</em> window, click the <strong>Y-Quantity</strong> button and select <strong>Load File</strong>.</li></ul><ul><li>In the file browser, go to the <em>ResultsInverseDynamics</em> folder, select the file <strong><em>inverse_dynamics.sto</em></strong>, and click <strong>Open</strong>.</li></ul><ul><li>In the menu, select <strong>ankle_angle_r_moment</strong> and <strong>ankle_angle_l_moment</strong> by clicking the corresponding checkboxes, then click <strong>OK</strong>.<br /><em style="font-size: 10.0pt;line-height: 13.0pt;">Note</em><span style="font-size: 10.0pt;line-height: 13.0pt;">: To quickly find these quantities, type ankle into the pattern text box.</span></li></ul><ul><li>Click the <strong>X-Quantity</strong> button, select <strong>time</strong>, and click <strong>OK</strong>.</li></ul><ul><li>Back in the <em>Plotter</em> window, click <strong>Add</strong> to add the moment curves to the plot.</li></ul><ul><li>Print your plot by <strong>right clicking</strong> on the plot and selecting <strong>Print</strong>.<br /><em>Note</em><em style="font-size: 10.0pt;line-height: 13.0pt;">: To export the plot as an image by <strong>right-clicking</strong> the plot and selecting <strong>Export Image</strong>.</em></li></ul><ul><li>After printing the plot and answering the following questions, <strong>close</strong> the <em>Plotter</em> window.</li></ul><h4 id="Tutorial3-Scaling,InverseKinematics,andInverseDynamics-Questions.3"><span style="color: rgb(0,0,0);">Questions</span></h4><p><span style="color: rgb(0,0,0);">7.<em> On your plot of the ankle moments, identify when heel strike, stance phase, toe off, and swing phase occur for each curve (i.e., left leg and right leg).</em></span></p><p>8.<em> Based on your plot and the angle convention for the ankle, give an explanation of what is happening at the ankle just before toe-off.</em><br /> <em>Hint</em><em>: It may be useful to use the Coordinate sliders to understand the angle convention for the ankle</em>.</p><p>In solving the inverse dynamics problem, both kinematical data <em>and</em> force plate data were used, making this an over-determined problem. In other words, the problem has more equations than unknowns (i.e., degrees of freedom). Due to errors in the experimental motion data and inaccuracies in the musculoskeletal model, it turns out that Newton's second law is violated, or <span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-thumbnail" width="100" src="attachments/5115855/5046836.png" data-image-src="attachments/5115855/5046836.png" data-unresolved-comment-count="0" data-linked-resource-id="5046836" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="f=ma.png" data-base-url="https://simtk-confluence.stanford.edu" data-linked-resource-content-type="image/png" data-linked-resource-container-id="5115855" data-linked-resource-container-version="33"></span> [3]. One method to handle this dynamical inconsistency is to compute and apply residual forces and moments to a particular body segment in the model, such that Newton's second law becomes:</p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-thumbnail" width="200" src="attachments/5115855/5046837.png" data-image-src="attachments/5115855/5046837.png" data-unresolved-comment-count="0" data-linked-resource-id="5046837" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="f=ma2.png" data-base-url="https://simtk-confluence.stanford.edu" data-linked-resource-content-type="image/png" data-linked-resource-container-id="5115855" data-linked-resource-container-version="33"></span></p><p><em>† An analogous equation relates the ground reaction moment, <span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-thumbnail" width="40" src="attachments/5115855/5046838.png" data-image-src="attachments/5115855/5046838.png" data-unresolved-comment-count="0" data-linked-resource-id="5046838" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="A1.png" data-base-url="https://simtk-confluence.stanford.edu" data-linked-resource-content-type="image/png" data-linked-resource-container-id="5115855" data-linked-resource-container-version="33"></span> to the residual moment, <span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-thumbnail" width="65" src="attachments/5115855/5046839.png" data-image-src="attachments/5115855/5046839.png" data-unresolved-comment-count="0" data-linked-resource-id="5046839" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="A2.png" data-base-url="https://simtk-confluence.stanford.edu" data-linked-resource-content-type="image/png" data-linked-resource-container-id="5115855" data-linked-resource-container-version="33"></span> . </em></p><p><span style="font-size: 10.0pt;line-height: 13.0pt;">In this musculoskeletal model, the residuals are applied to the pelvis segment. </span></p><p>To see the residuals from the inverse dynamics solution:</p><ul><li>Click <strong>Tools</strong> and select <strong>Plot</strong>.</li></ul><ul><li>In the Plotter window, click the <strong>Y-Quantity</strong> button and select <strong>Load File</strong>.</li></ul><ul><li>In the file browser, go to the <em>ResultsInverseDynamics</em> folder, select the file <strong><em>inverse_dynamics.sto</em></strong>, and click <strong>Open</strong>.</li></ul><ul><li>In the menu, select <strong>pelvis_tx_force</strong>, <strong>pelvis_ty_force</strong>, and <strong>pelvis_tz_force</strong> by clicking the corresponding <strong>checkboxes</strong>, then click <strong>OK</strong>.</li></ul><ul><li>Click the <strong>X-Quantity</strong> button, select <strong>time</strong>, and click <strong>OK</strong>.</li></ul><ul><li>Click <strong>Add</strong> to add the curves to the plot.</li></ul><h4 id="Tutorial3-Scaling,InverseKinematics,andInverseDynamics-Questions.4">Questions</h4><p>9.<em> What are the maximum magnitudes of the residual forces? Using the mass of the subject from Question 1, what fraction of body weight are the maximum residual forces?</em></p><p><br class="atl-forced-newline" />While computing and applying residual forces and moments makes the model's motion dynamically consistent with the external forces <span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-thumbnail" width="100" src="attachments/5115855/5046840.png" data-image-src="attachments/5115855/5046840.png" data-unresolved-comment-count="0" data-linked-resource-id="5046840" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="f=ma3.png" data-base-url="https://simtk-confluence.stanford.edu" data-linked-resource-content-type="image/png" data-linked-resource-container-id="5115855" data-linked-resource-container-version="33"></span>, this strategy is undesirable because the residuals can be large. More advanced strategies have been developed to deal with the problem of residuals and dynamic inconsistencies, such as least-squares optimization [3], the Residual Elimination Algorithm (REA) [5], and the Residual Reduction Algorithm (RRA) [6]. Additionally, OpenSim implements a Residual Reduction Algorithm as part of its workflow for generating muscle-actuated simulations [7]. Reference [6] is attached at the end of this tutorial. For additional information on these strategies, please also refer to [3], [5], and [7].</p><h5 id="Tutorial3-Scaling,InverseKinematics,andInverseDynamics-References"><span style="color: rgb(0,0,0);">References</span></h5><p>1. Delp, S.L., Loan, J.P., Hoy, M.G., Zajac, F.E., Topp E.L., Rosen, J.M. An interactive graphics-based model of the lower extremity to study orthopaedic surgical procedures. <em>IEEE Transactions on Biomedical Engineering</em>, vol. 37, pp. 757-767, 1990.</p><p>2. Anderson, F.C., Pandy, M.G. A dynamic optimization solution for vertical jumping in three dimensions. <em>Computer Methods in Biomechanical and Biomedical Engineering</em>, vol. 2, pp. 201-231, 1999.</p><p>3. Kuo, A.D. A least squares estimation approach to improving the precision of inverse dynamics computations, <em>Journal of Biomechanical Engineering</em>, vol. 120, pp. 148-159, 1998.</p><p>4. Winter, D.A. <em>Biomechanics and Motor Control of Human Movement</em>, Wiley and Sons, pp. 77-79, 1990.</p><p>5. Thelen, D.G., Anderson, F.C. Using computed muscle control to generate forward dynamic simulations of human walking from experimental data, <em>Journal of Biomechanics</em>, vol. 39, pp. 1107-1115, 2006.</p><p>6. John, C.T., Anderson, F.C., Guendelman, E., Arnold, A.S., Delp, S.L. An algorithm for generating muscle-actuated simulations of long-duration movements, <em>Biomedical Computation at Stanford (BCATS) Symposium</em>, Stanford University, 21 October 2006, Poster Presentation.</p><p>7. Delp, S.L., Anderson, F.C., Arnold, A.S., Loan, P., Habib, A., John, C.T., Guendelman, E., Thelen, D.G. OpenSim: Open-source software to create and analyze dynamic simulations of movement. <em>IEEE Transactions on Biomedical Engineering</em>, vol. 55, pp. 1940-1950, 2007.</p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" height="808" width="767" src="attachments/5115855/5046834.png" data-image-src="attachments/5115855/5046834.png" data-unresolved-comment-count="0" data-linked-resource-id="5046834" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="worddav5d73018c1676a8f841fa7d4da9f6e2f5.png" data-base-url="https://simtk-confluence.stanford.edu" data-linked-resource-content-type="image/png" data-linked-resource-container-id="5115855" data-linked-resource-container-version="33"></span></p>
                    </div>

                                        <div class="pageSection group">
                        <div class="pageSectionHeader">
                            <h2 id="attachments" class="pageSectionTitle">Attachments:</h2>
                        </div>

                        <div class="greybox" align="left">
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/5115855/5046762.jpg">opensimWorkflow.jpg</a> (image/jpeg)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/5115855/5046835.png">Ik.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/5115855/5046798.png">John C et al.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/5115855/5046826.png">worddav18beee95e9328969b6f5ee05a6c736f0.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/5115855/5046827.png">worddav53e4ce5eeb1168ced486b5fe01242946.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/5115855/5046828.png">worddav613169f3722e482985e2b7ba46883866.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/5115855/5046829.png">worddavb4a9dd8ab565b355703f192d38c79502.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/5115855/5046830.png">worddavbcdb16810065b04ec7b04e7d88674d2b.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/5115855/5046831.png">worddav67715acaa743536b48920ad4279aa67d.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/5115855/5046832.png">worddavda7152d5293fb6714ee6f00830cfd709.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/5115855/5046833.png">worddav9561c60e960dcd720fc44bf54521ad42.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/5115855/5046834.png">worddav5d73018c1676a8f841fa7d4da9f6e2f5.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/5115855/5046763.png">Ik.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/5115855/5046836.png">f=ma.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/5115855/5046837.png">f=ma2.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/5115855/5046838.png">A1.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/5115855/5046839.png">A2.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/5115855/5046840.png">f=ma3.png</a> (image/png)
                                <br/>
                                                    </div>
                    </div>
                    
                 
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on Jul 05, 2018 11:24</p>
                    <div id="footer-logo"><a href="http://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
